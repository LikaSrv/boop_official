
<%# body %>
<div class="container">
  <%# General information %>
  <div class="row d-flex justify-content-center">
    <div class="col-lg-5 col-md-5 col-sm-10 card_pro" style="height: 400px;">
      <% if @pet.photo.present? %>
        <%= image_tag @pet.photo_url, class: "card-img-top w-100 h-100 object-fit-cover rounded"%>
      <% else %>
        <%= image_tag("#{ENV['SUPABASE_URL']}/storage/v1/object/public/general_images/Design%20sans%20titre%20(1).jpg",
                      alt: "photo_pet_default",
                      class: "card-img-top w-100 h-100 object-fit-cover rounded")%>
      <% end %>
    </div>
    <div class="col-lg-5 col-md-5 col-sm-10 card_pro d-flex flex-column justify-content-between">
      <div>
        <h3 class="text-center m-3"><%= @pet.name %></h3>
        <p class="my-2">Âge:
          <% if @pet.birthday.present? %>
            <% age_in_years = (Date.today - @pet.birthday).to_i / 365.25 %>
            <% if age_in_years >= 0 %>
              <%= age_in_years.round %> ans
            <% else %>
              <% age_in_months = (Date.today.month - @pet.birthday.month) + (Date.today.year - @pet.birthday.year) * 12 %>
              <%= age_in_months.abs %> mois
            <% end %>
          <% else %>
            0
          <% end %>
        </p>
        <p>Sexe: <%= @pet.sex %></p>
        <p class="my-2">Race: <%= @pet.species %></p>
        <p class="my-2">Identification: <%= @pet.identification %></p>
        <p class="my-2">Antécédents médicaux: <%= @pet.medical_background %></p>
      </div>
      <div>

          <p style="font-size: 36px"> <i class="fa-solid fa-paw float-end text-primary"></i></p>

      </div>
    </div>
  </div>
  <%# appointments %>
  <div class="row card_pro text-center position-relative">
    <h3 class="text-center m-3">Les rendez-vous</h3>
    <% if @appointments.empty? %>
      <div class="text-center">
        <p >Vous n'avez pas de rendez-vous</p>
      </div>
    <% else %>
      <% @appointments.each do |a| %>
        <div class="col-lg-4 col-md-12 col-12">
          <div class="card_pro p-4 m-1 text-start" style="background-color: #f7e6d4;">
            <div class="text-end">

                <p><%= a.start_time.strftime("%d/%m/%Y")%></p>
                <p><%= a.start_time.strftime("%H:%M")%></p>

            </div>
            <p>Professionnel : <strong><%= a.professional.name %></strong></p>
            <p style="word-wrap: break-word; word-break: break-word;">Motif de la visite : <%= truncate(a.reason, length: 100, omission: '...') %></p>
          </div>
        </div>
      <% end %>
    <% end%>
  </div>
  <%# les vaccins %>
  <div class="card_pro d-flex flex-column justify-content-between p-4 position-relative" data-controller="alert" >

      <h3 class="text-center m-3">Les vaccins</h3>
      <%i=0%>
      <% if @vaccinations.empty? %>
        <p class="mt-3 text-center">Vous n'avez pas encore saisi les informations de vaccins.</p>
      <% else %>
        <div class="d-flex flex-wrap" id="vaccins-container" >
          <% @vaccinations.each do |vaccin| %>
            <% i = i+1 %>
            <div class="card_pro m-1 text-start d-flex flex-row vaccination-item" style="background-color: #f7e6d4;">
              <p><%=i%>.</p>
              <div class="mx-2">
                <div class="d-flex flex-row">
                  <p>Nom de vaccin : </p>
                  <p class="mx-2 vaccin-name"> <strong><%= vaccin.name%></strong></p>
                </div>
                <div class="d-flex flex-row">
                  <p>Date d'injection : </p>
                  <p class="mx-2 vaccin-administration-date"> <%= vaccin.administration_date.strftime("%d-%m-%Y")%></p>
                </div>
                <div class="d-flex flex-row">
                  <p>Prochaine date : </p>
                  <p class="mx-2 <%= vaccin.next_booster_date > Date.today ? 'text-success' : 'text-danger' %> vaccin-next-booster-date">
                    <%=vaccin.next_booster_date.strftime("%d-%m-%Y")%>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

  </div>
  <%# Weight  %>
  <div class="card_pro d-flex flex-column justify-content-between position-relative">
    <div data-controller="chart alert">
      <h3 class="text-center m-3">Le suivi de poids</h3>
      <% if @weight_histories.empty?%>
        <p class="text-center">Vous n'avez pas encore commencé le suivi de poids de <%=@pet.name%></p>
      <% else %>
        <div data-controller="chart" class="p-4">
          <canvas id="myLine" data-chart-target="chart"
                              data-label="<%= @weight_histories_labels.to_json %>"
                              data-values="<%= @weight_histories_data.to_json %>"
                              data-ids="<%= @weight_histories_ids.to_json %>"
                              data-petId="<%= @pet.id %>">
          </canvas>
        </div>
      <% end %>
    </div>
  </div>
</div>
